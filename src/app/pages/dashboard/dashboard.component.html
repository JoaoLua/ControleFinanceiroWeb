<div class="dashboard-container">

  <header class="page-header">
    <div>
      <h1>Visão Geral</h1>
      <p class="subtitle">Acompanhe sua saúde financeira</p>
    </div>
  </header>

  @if (resumo; as dados) {
    <section class="kpi-grid">
      
      <mat-card class="kpi-card total">
        <mat-card-header>
          <div mat-card-avatar class="icon-bg neutral">
            <mat-icon>account_balance</mat-icon>
          </div>
          <mat-card-subtitle>Saldo Total</mat-card-subtitle>
          <mat-card-title>{{ dados.saldoTotal | currency:'BRL' }}</mat-card-title>
        </mat-card-header>
      </mat-card>

      <mat-card class="kpi-card income">
        <mat-card-header>
          <div mat-card-avatar class="icon-bg success">
            <mat-icon>trending_up</mat-icon>
          </div>
          <mat-card-subtitle>Receitas (Mês)</mat-card-subtitle>
          <mat-card-title>{{ dados.receitaMensal | currency:'BRL' }}</mat-card-title>
        </mat-card-header>
      </mat-card>

      <mat-card class="kpi-card expense">
        <mat-card-header>
          <div mat-card-avatar class="icon-bg danger">
            <mat-icon>trending_down</mat-icon>
          </div>
          <mat-card-subtitle>Despesas (Mês)</mat-card-subtitle>
          <mat-card-title>{{ dados.despesaMensal | currency:'BRL' }}</mat-card-title>
        </mat-card-header>
      </mat-card>

      <mat-card class="kpi-card balance">
        <mat-card-header>
          <div mat-card-avatar class="icon-bg info">
            <mat-icon>savings</mat-icon>
          </div>
          <mat-card-subtitle>Balanço do Mês</mat-card-subtitle>
          <mat-card-title [class.negative]="dados.saldoMensal < 0">
            {{ dados.saldoMensal | currency:'BRL' }}
          </mat-card-title>
        </mat-card-header>
      </mat-card>
    </section>

    <section class="main-content">
      
      <mat-card class="chart-panel">
        <mat-card-header>
          <mat-card-title>Composição Mensal</mat-card-title>
        </mat-card-header>
        <mat-card-content class="chart-wrapper">
          <canvas baseChart
            [data]="chartData"
            [options]="chartOptions"
            [type]="chartType">
          </canvas>
        </mat-card-content>
      </mat-card>

      <mat-card class="table-panel">
        <mat-card-header class="table-header">
          <mat-card-title>Últimas Movimentações</mat-card-title>
          <button mat-button color="primary">Ver todas</button>
        </mat-card-header>
        
        <mat-card-content>
          <table mat-table [dataSource]="transacoes" class="full-width-table">
            
            <ng-container matColumnDef="descricao">
              <th mat-header-cell *matHeaderCellDef> Descrição </th>
              <td mat-cell *matCellDef="let element"> 
                <span class="row-title">{{ element.descricao }}</span>
              </td>
            </ng-container>
            
            <ng-container matColumnDef="categoria">
              <th mat-header-cell *matHeaderCellDef class="hide-mobile"> Categoria </th>
              <td mat-cell *matCellDef="let element" class="hide-mobile"> 
                <span class="category-badge">{{ element.categoriaNome }}</span> 
              </td>
            </ng-container>

            <ng-container matColumnDef="data">
              <th mat-header-cell *matHeaderCellDef> Data </th>
              <td mat-cell *matCellDef="let element"> {{ element.data | date:'dd/MM' }} </td>
            </ng-container>

            <ng-container matColumnDef="valor">
              <th mat-header-cell *matHeaderCellDef> Valor </th>
              <td mat-cell *matCellDef="let element" 
                  [class.text-success]="element.tipo === 0" 
                  [class.text-danger]="element.tipo === 1">
                <strong>
                  {{ element.tipo === "Despesa" ? '-' : '+' }}
                  {{ element.valor | currency:'BRL' }}
                </strong>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          @if (transacoes.length === 0) {
            <div class="empty-state">
              <p>Nenhuma transação recente.</p>
            </div>
          }
        </mat-card-content>
      </mat-card>
    </section>

  } @else {
    <div class="loading-state">
      <p>Carregando informações financeiras...</p>
    </div>
  }
</div>